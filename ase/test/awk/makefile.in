#
# $Id: makefile.in,v 1.6 2007/11/11 15:06:47 bacon Exp $
#

CC = @CC@
CXX = @CXX@
CFLAGS = @CFLAGS@ -I@abs_top_builddir@/.. 
LDFLAGS = @LDFLAGS@ -L@abs_top_builddir@/@BUILDMODE@/lib
LIBS = @LIBS@ -laseawk -lasecmn -laseutl -lm
LIBS_CXX = -laseawk++ ${LIBS} 
MODE = @BUILDMODE@

JAVAC = @JAVAC@
JAR = @JAR@
CFLAGS_JNI = @CFLAGS_JNI@
JNI = @JNI@

OUT_DIR= ../../$(MODE)
OUT_DIR_LIB = $(OUT_DIR)/lib
OUT_DIR_BIN = $(OUT_DIR)/bin
TMP_DIR = $(MODE)

ASEAWK_LIB = 

all: build$(JNI)

build: $(TMP_DIR) $(OUT_DIR_BIN) $(OUT_DIR_BIN)/aseawk $(OUT_DIR_BIN)/aseawk_mini $(OUT_DIR_BIN)/aseawk++

buildjni: build $(OUT_DIR_BIN)/aseawk.jar $(OUT_DIR)/AseAwkApplet.html $(OUT_DIR)/AseAwkApplet.js 

$(OUT_DIR_BIN)/aseawk: awk.c
	$(CC) $(CFLAGS) -o $@ awk.c $(LDFLAGS) $(LIBS)

$(OUT_DIR_BIN)/aseawk_mini: mini.c
	$(CC) $(CFLAGS) -o $@ mini.c $(LDFLAGS) $(LIBS)

$(OUT_DIR_BIN)/aseawk++: Awk.cpp
	$(CXX) $(CFLAGS) -o $@ Awk.cpp $(LDFLAGS) $(LIBS_CXX)

$(OUT_DIR_BIN)/aseawk.jar: $(TMP_DIR)/AseAwkPanel.class $(TMP_DIR)/AseAwk.class $(TMP_DIR)/AseAwkApplet.class
	cd $(TMP_DIR); $(JAR) -xvf ../$(OUT_DIR_LIB)/aseawk.jar 
	cd $(TMP_DIR); $(JAR) -cvfm ../$@ ../manifest *.class ase
	rm -rf $(TMP_DIR)/ase

$(TMP_DIR)/AseAwkPanel.class: AseAwkPanel.java 
	$(JAVAC) -classpath $(TMP_DIR):$(OUT_DIR_LIB)/aseawk.jar -d $(TMP_DIR) AseAwkPanel.java

$(TMP_DIR)/AseAwk.class: AseAwk.java
	$(JAVAC) -classpath $(TMP_DIR):$(OUT_DIR_LIB)/aseawk.jar -d $(TMP_DIR) AseAwk.java

$(TMP_DIR)/AseAwkApplet.class: AseAwkApplet.java 
	$(JAVAC) -classpath $(TMP_DIR):$(OUT_DIR_LIB)/aseawk.jar -d $(TMP_DIR) AseAwkApplet.java

$(OUT_DIR)/AseAwkApplet.html: AseAwkApplet.html
	cp -pf AseAwkApplet.html $(OUT_DIR)

$(OUT_DIR)/AseAwkApplet.js: AseAwkApplet.js
	cp -pf AseAwkApplet.js $(OUT_DIR)

$(OUT_DIR_BIN):
	mkdir -p $(OUT_DIR_BIN)

$(TMP_DIR):
	mkdir -p $(TMP_DIR)

clean:
	rm -rf $(OUT_DIR_BIN)/aseawk $(OUT_DIR_BIN)/aseawk_mini $(OUT_DIR_BIN)/aseawk++ 
	rm -rf $(OUT_DIR_BIN)/aseawk.jar $(OUT_DIR)/AseAwkApplet.html $(OUT_DIR)/AseAwkApplet.js $(TMP_DIR)/*.class

