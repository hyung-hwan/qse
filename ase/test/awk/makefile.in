#
# $Id: makefile.in,v 1.5 2007/05/06 08:10:31 bacon Exp $
#

CC = @CC@
CXX = @CXX@
CFLAGS = @CFLAGS@ -I@abs_top_builddir@/.. 
LDFLAGS = @LDFLAGS@ -L@abs_top_builddir@/@BUILDMODE@/lib
LIBS = @LIBS@ -laseawk -lasecmn -laseutl -lm
LIBS_CXX = -laseawk++ ${LIBS} 
MODE = @BUILDMODE@

JAVAC = @JAVAC@
JAR = @JAR@
CFLAGS_JNI = @CFLAGS_JNI@
JNI = @JNI@

LIB_DIR = ../../$(MODE)/lib
OUT_DIR = ../../$(MODE)/bin
TMP_DIR = $(MODE)

ASEAWK_LIB = 

all: build$(JNI)

build: $(TMP_DIR) $(OUT_DIR) $(OUT_DIR)/aseawk $(OUT_DIR)/aseawk_mini $(OUT_DIR)/aseawk++

buildjni: build $(OUT_DIR)/aseawk.jar $(OUT_DIR)/AseAwkApplet.html 

$(OUT_DIR)/aseawk: awk.c
	$(CC) $(CFLAGS) -o $@ awk.c $(LDFLAGS) $(LIBS)

$(OUT_DIR)/aseawk_mini: mini.c
	$(CC) $(CFLAGS) -o $@ mini.c $(LDFLAGS) $(LIBS)

$(OUT_DIR)/aseawk++: Awk.cpp
	$(CXX) $(CFLAGS) -o $@ Awk.cpp $(LDFLAGS) $(LIBS_CXX)

$(OUT_DIR)/aseawk.jar: $(TMP_DIR)/AseAwkPanel.class $(TMP_DIR)/AseAwk.class $(TMP_DIR)/AseAwkApplet.class
	cd $(TMP_DIR); $(JAR) -xvf ../$(LIB_DIR)/aseawk.jar 
	cd $(TMP_DIR); $(JAR) -cvfm ../$@ ../manifest *.class ase
	rm -rf $(TMP_DIR)/ase

$(TMP_DIR)/AseAwkPanel.class: AseAwkPanel.java 
	$(JAVAC) -classpath $(TMP_DIR):$(LIB_DIR)/aseawk.jar -d $(TMP_DIR) AseAwkPanel.java

$(TMP_DIR)/AseAwk.class: AseAwk.java
	$(JAVAC) -classpath $(TMP_DIR):$(LIB_DIR)/aseawk.jar -d $(TMP_DIR) AseAwk.java

$(TMP_DIR)/AseAwkApplet.class: AseAwkApplet.java 
	$(JAVAC) -classpath $(TMP_DIR):$(LIB_DIR)/aseawk.jar -d $(TMP_DIR) AseAwkApplet.java

$(OUT_DIR)/AseAwkApplet.html: AseAwkApplet.html
	cp -pf AseAwkApplet.html $(OUT_DIR)

$(OUT_DIR):
	mkdir -p $(OUT_DIR)

$(TMP_DIR):
	mkdir -p $(TMP_DIR)

clean:
	rm -rf $(OUT_DIR)/aseawk $(OUT_DIR)/aseawk_mini $(OUT_DIR)/aseawk++ $(OUT_DIR)/aseawk.jar $(OUT_DIR)/AseAwkApplet.html $(TMP_DIR)/*.class

